{"version":3,"sources":["file:///Users/shashankchaurasia/CocosWorkspace/3dDemoGame/assets/Script/socket/SocketConnection.ts"],"names":["Component","_decorator","Colyseus","ccclass","property","SocketConnection","constructor","instance","start","url","useSSL","hostname","includes","port","client","Client","console","log","connect","room","joinOrCreate","sessionId","onLeave","code","isConnected","state","playerMap","onAdd","player","key","addPlayerToWorld","onChange","changes","onPlayerChange","triggerAll","e","error","send","msg","playerContext"],"mappings":"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","sourcesContent":["\nimport { Component, Primitive, TERRAIN_HEIGHT_BASE, _decorator } from 'cc';\nimport Colyseus from 'db://colyseus-sdk/colyseus.js';\nimport { Player } from '../Player';\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('SocketConnection')\nexport class SocketConnection extends Component {\n\n    static instance: SocketConnection;\n    playerName: string;\n    isConnected: boolean = false;\n\n    @property hostname = \"localhost\";\n    @property port = 2567;\n    @property useSSL = false;\n\n    client!: Colyseus.Client;\n    room!: Colyseus.Room;\n\n    constructor() {\n        super();\n        SocketConnection.instance = this;\n    }\n\n    start() {\n\n        // Instantiate Colyseus Client\n        // connects into (ws|wss)://hostname[:port]\n\n        /* let domain = window.location.href.split('/')[2];\n        let url = \"ws://\" + domain.split(':')[0] + ':2567'; */\n\n        let url = `${this.useSSL ? \"wss\" : \"ws\"}://${this.hostname}${([443, 80].includes(this.port) || this.useSSL) ? \"\" : `:${this.port}`}`;\n        this.client = new Colyseus.Client(`${this.useSSL ? \"wss\" : \"ws\"}://${this.hostname}${([443, 80].includes(this.port) || this.useSSL) ? \"\" : `:${this.port}`}`);\n\n        console.log(`Connecting server to ${url}`);\n        this.connect();\n    }\n\n\n    async connect() {\n        try {\n            this.room = await this.client.joinOrCreate(\"SumoRoom\");\n\n            console.log(\"Room joined successfully!\");\n            console.log(\"user's sessionId:\", this.room.sessionId);\n\n            // this.room.onStateChange((state) => {\n            //     console.log(\"onStateChange: \", state);\n            // });\n\n            this.room.onLeave((code) => {\n                console.log(\"onLeave:\", code);\n                this.isConnected = false;\n            });\n\n            /* this.room.state.playerMap.onChange = (player, key) => {\n                console.log(player, \"have changes at\", key);\n            };\n            */\n\n            this.room.state.playerMap.onAdd = (player, key) => {\n                console.log(player, \"has been added at\", key);\n\n                this.isConnected = true;\n\n                // add your player entity to the game world!\n                this.addPlayerToWorld(player, key);\n\n                // If you want to track changes on a child object inside a map, this is a common pattern:\n                player.onChange = function (changes) {\n                    SocketConnection.instance.onPlayerChange(this);\n                };\n\n                // force \"onChange\" to be called immediatelly\n                player.triggerAll();\n            };\n\n            \n\n        } catch (e) {\n            console.error(e);\n        }\n    }\n\n    send(msg) {\n        this.room.send('action', msg)\n    }\n\n    onPlayerChange(playerContext) {\n\n    }\n\n    addPlayerToWorld(player, key) {\n    }\n}\n"]}