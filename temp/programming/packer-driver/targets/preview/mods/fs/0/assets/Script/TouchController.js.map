{"version":3,"sources":["file:///D:/Office/mmo_movement/assets/Script/TouchController.ts"],"names":["_decorator","Component","Node","EventHandler","Vec3","director","macro","ccclass","property","TouchController","type","tooltip","start","node","on","EventType","TOUCH_MOVE","touchMove","TOUCH_START","touchStart","TOUCH_END","touchEnded","touch","loc","getLocation","pos","x","startLoc","y","mag","Math","sqrt","lerp","angle","get_angle","touchEventCallBack","forEach","c","emit","cx","cy","ex","ey","dy","dx","theta","atan2","DEG","restartGame","loadScene"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, Node, Vec2, EventHandler, EventTouch, Vec3, director, macro } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('TouchController')\nexport class TouchController extends Component {\n\n    startLoc: Vec2;\n\n    @property({\n        type: [EventHandler],\n        tooltip: 'Touch Event Listener'\n    })\n    touchEventCallBack: EventHandler[] = [];\n\n    start() {\n        this.node.on(Node.EventType.TOUCH_MOVE, this.touchMove, this);\n        this.node.on(Node.EventType.TOUCH_START, this.touchStart, this);\n        this.node.on(Node.EventType.TOUCH_END, this.touchEnded, this);\n    }\n\n    touchMove(touch: EventTouch) {\n        let loc = touch.getLocation();\n        let pos = new Vec3(loc.x - this.startLoc.x, loc.y - this.startLoc.y);\n\n        let mag = Math.sqrt(pos.x * pos.x + pos.y * pos.y);\n        if (mag > 200) {\n            this.startLoc = this.startLoc.lerp(loc, 0.9);\n            pos = new Vec3(loc.x - this.startLoc.x, loc.y - this.startLoc.y);\n        }\n\n        let angle = this.get_angle(this.startLoc.x, this.startLoc.y, loc.x, loc.y);\n        this.touchEventCallBack.forEach(c => c.emit([pos, angle]));\n    }\n\n    touchEnded(touch: EventTouch) {\n        this.touchEventCallBack.forEach(c => c.emit([new Vec3(0, 0, 0)]));\n    }\n\n    touchStart(touch: EventTouch) {\n        this.startLoc = touch.getLocation();\n        this.touchMove(touch);\n    }\n\n    get_angle(cx: number, cy: number, ex: number, ey: number) {\n        let dy = ey - cy;\n        let dx = ex - cx;\n        let theta = Math.atan2(dy, dx);\n        // theta *= 180 / Math.PI;\n        return theta * macro.DEG;\n    }\n\n    restartGame() {\n        director.loadScene('GameScene');\n    }\n\n}"]}